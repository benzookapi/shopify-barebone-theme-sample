{% comment %}
  *** Cart page ***
  See https://shopify.dev/docs/themes/architecture/templates/cart
{% endcomment %}
<div class="my_section my_cart">
  <!-- Cart section -->
  <div class="my_block_title">Section</div>

  <h2>{{ section.settings.my_title }}</h2>

  <form action="{{ routes.cart_url }}" method="post">
    <table>
      {% for item in cart.items %}
        <tr>
          <td>{{ item | image_url: width: 50 | image_tag: height: 50 }}</td>
          <td>
            <!-- Item title -->
            <a href="{{ item.url }}">{{ item.title }}</a>

            <!-- Line item properties -->
            {% unless item.properties == empty %}
              {% for property in item.properties %}
                {% unless property.last == '' %}
                  <div style="font-size: small; color: #666666; margin-top: 2px;">
                    {{ property.first }}:

                    {% if property.last contains '/uploads/' %}
                      <a href="{{ property.last }}">{{ property.last | split: '/' | last }}</a>
                    {% else %}
                      {{ property.last }}
                    {% endif %}
                  </div>
                {% endunless %}
              {% endfor %}
            {% endunless %}
          </td>
          <td>
            x
            <input
              type="text"
              value="{{ item.quantity }}"
              size="2"
              onchange="cartUpdate(this);"
              id="{{ item.key }}"
            >
            <a href="{{ item.url_to_remove }}">🗑️</a>
          </td>
          <td>{{ item.original_line_price | money }}</td>
        </tr>
      {% endfor %}
    </table>

    {% if cart.item_count == 0 %}
      <p>🤷‍♂️ Your cart is empty.</p>
    {% endif %}

    {% if cart.item_count > 0 %}
      <!-- Total price and checkout button -->
      <div style="width: 95%; text-align: right;" class="my_top_space my_bottom_space">
        <p class="my_font_large">🛍️ Total: {{ cart.total_price | money_with_currency }}</p>
        <input type="submit" name="checkout" value="Checkout" class="my_font_large" style="width: 20%;">
      </div>
    {% endif %}
  </form>

  {% render 'home' %}

  <p>👉 <a href="https://shopify.dev/docs/themes/architecture/templates/cart" target="_blank">Dev. doc</a></p>
</div>

<script>
  const cartUpdate = (obj) => {
    // Update the item quantity.
    // See https://shopify.dev/docs/api/ajax
    // See https://shopify.dev/docs/api/ajax/reference/cart#update-line-item-quantities
    const url = `${window.Shopify.routes.root}cart/update.js`;
    console.log(`url: ${url}`);
    const body = `updates[${obj.id}]=${obj.value}`;
    console.log(`body: ${body}`);
    fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: body,
    })
      .then((response) => response.json())
      .then((data) => {
        console.log(`data: ${JSON.stringify(data)}`);
      });
  };
</script>

{% schema %}
{
  "name": "t:sections.cart.name",
  "limit": 1,
  "settings": [
    {
      "type": "text",
      "id": "my_title",
      "label": "Cart title",
      "default": "THIS IS MY CART"
    }
  ],
  "enabled_on": {
    "templates": ["cart"]
  }
}
{% endschema %}
